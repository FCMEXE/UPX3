<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quadras - QuadraConecta</title>

    <link rel="stylesheet" href="style.css" />

    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />

  </head>

  <body>
    <nav class="sidebar close">
      <header>
        <div class="image-text">
          <span class="image">
           <i class='bx bxs-lemon icon'></i>
          </span>

          <div class="text logo-text">
            <span class="name">QuadraConecta</span>
            <span class="profession">Forjados do Fogo</span>
          </div>
        </div>

        <i class="bx bx-chevron-right toggle"></i>
      </header>

      <div class="menu-bar">
        <div class="menu">
          <li class="search-box">
            <i class="bx bx-search icon"></i>
            <input type="text" placeholder="Procure Lobbies" />
          </li>

          <ul class="menu-links">


            <li class="nav-link" onclick=" getLobbiesByUserId(userId)" data-file="Home/home.html">
              <a href="#" >
                <i class="bx bx-home-alt icon"></i>
                <span class="text nav-text">Home</span>
              </a>
            </li>

            <li class="nav-link" onclick="fetchCards()"  data-file="quadras.html">
              <a href="#" >
                <i class='bx bx-basketball icon'></i>
                <span class="text nav-text">Quadras</span>
              </a>
            </li>

            <li class="nav-link" onclick="fetchLobbies()"  data-file="lobbie.html">
              <a href="#">
                <i class='bx bx-search-alt-2 icon'></i>
                <span class="text nav-text">Lobbies </span>
              </a>
            </li>
           
            <li class="nav-link"  data-file="Agenda/agenda.html">
              <a href="#">
                <i class="bx bx-pie-chart-alt icon"></i>
                <span class="text nav-text"> Agenda</span>
              </a>
            </li>
          </ul>
        </div>


         <div class="bottom-content" >
         

        <div class="bottom-content">
          <li class="nav-link"  data-file="LogOut/logout.html">
            <a href="#">
              <i class="bx bx-log-out icon"></i>
              <span class="text nav-text">Sair</span>
            </a>
          </li>

         
        </div>
      </div>
    </nav>

        <section class="home">
          
          
        </section>
        
          <section class="cardsSec">
            <div class="containerCard" id="containerCardId"></div>
            <div class="containerCard" id="containerLobbiesId"></div>
            <div class="tokenModal"></div>
             <div class="cardQuadras-content" id="myLobbies"></div>
            
             
        </section>

  </body>
    <script src="main.js"></script>
    <script src="/MainSystem/LogOut/logOut.js"></script>
    <script>
        function fetchCards() {
            fetch('https://6626eb22b625bf088c06e78f.mockapi.io/quadras')
            .then(response => response.json())
            .then(data => {
                const cardsContainer = document.getElementById("containerCardId");
                cardsContainer.innerHTML = '';

                data.forEach(quadra => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    
                    card.innerHTML = `
                        <div class="box" id="boxCard">
                            <div class="content" id="contentCard">
                                <h2>${quadra.id}</h2>
                                <h3>${quadra.nomequadra}</h3>
                                <p>Número de Players: ${quadra.numeroplayers}</p>
                                <p>Preço por Hora: ${quadra.precohora}</p>
                                <p>Tipo solo: ${quadra.tipoquadra}</p>

                                <button class="btnCard" onclick="CreateLobbie(${quadra.id})">Criar Lobbie</button>
                            </div>
                        </div>
                    `;
                    cardsContainer.appendChild(card);
                });
            })
            .catch(error => console.log("erro:", error))
        };


        function CreateLobbie(quadraId) {
          window.location.href = `LobbieCreate.html?quadraId=${quadraId}`;
        }

        function tokenProp() {
          alert = "Digite o token "
          window.location.href = "userHome.html"
        }


          // Lobbies Render
          

          function fetchLobbies() {
            fetch('https://66416a533d66a67b3433d202.mockapi.io/lobbie/userLobbies')
            .then(response => response.json())
            .then(data => {
                const cardsContainer = document.getElementById("containerLobbiesId");
                cardsContainer.innerHTML = '';

                data.forEach(lobbies => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    
                    card.innerHTML = `
                        <div class="box">
              <div class="content">
                <h2>${lobbies.id}</h2>
                <h3>${lobbies.nome}</h3>
                <p> seu lobbie foi marcado para
                 ${lobbies.horario}, caso mais duvidas acesse a agenda!
                </p>
                
              </div>
            </div>
                    `;
                    cardsContainer.appendChild(card);
                });
            })
            .catch(error => console.log("erro:", error))
        }

                // Obtém o ID do usuário do localStorage
const userId = localStorage.getItem('userID');

// Função para obter todos os lobbies do usuário
function getLobbiesByUserId(userId) {
  fetch(`https://66416a533d66a67b3433d202.mockapi.io/lobbie/userLobbies?userid=${userId}`)
    .then(response => response.json())
    .then(data => {
      

      // Inverte a ordem do array
      const reversedData = data.slice().reverse();

      // Seleciona apenas os três primeiros elementos
      const lastThreeLobbies = reversedData.slice(0, 3);

      const myLobbies = document.getElementById("myLobbies");
      myLobbies.innerHTML = '';

      lastThreeLobbies.forEach(lobbies => {
        const cardLobbie = document.createElement("div");
        cardLobbie.classList.add("cardQuadras-content");

        cardLobbie.innerHTML = `
          <div class="card">
            <div class="card-details">
              <p class="text-title">${lobbies.nome}</p>
              <p class="text-body">Horario:${lobbies.horario}</p>
              <p class="text-body">Numero de players(Max):${lobbies.numerodeplayers}</p>
            </div>
            <button class="card-button">${lobbies.id}</button>
          </div>`;
        myLobbies.appendChild(cardLobbie);
      });
    })
    .catch(error => console.log("erro:", error));
}

// Chama a função para obter os lobbies do usuário
getLobbiesByUserId(userId);

    function gerarHorarios() {
        const userId = localStorage.getItem('userID');
        const url = `https://66416a533d66a67b3433d202.mockapi.io/lobbie/userLobbies/?userid=${userId}`;
        const resposta =  fetch(url);
        const resultado =  resposta.json();

        // Preencher a tabela com os horários
        const diasSemana = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado', 'domingo'];
        const horarios = [
            "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00",
            "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"
        ]

        const tabela = document.getElementById('tableId');

        resultado.forEach(agenda => {
            const diaSemana = agenda.diaSemana;
            const horario = agenda.horario;
            const nome = agenda.nome;

            const indexDia = diasSemana.indexOf(diaSemana) + 1;
            const indexHorario = horarios.indexOf(horario) + 1;

            if (indexDia > 0 && indexDia < tabela.rows.length && indexHorario > 0) {
                // Preencher a célula correspondente com 'Agendado'
                const horarioCell = tabela.rows[indexHorario].cells[indexDia];
                horarioCell.textContent = nome;
                horarioCell.style.backgroundColor = 'forestgreen';
            }
        });
    }

    gerarHorarios();



    </script>

    
    
</html>
